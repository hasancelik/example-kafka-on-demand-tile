---
label: Kafka
description: Kafka example service
icon_image: AAAA
minimum_version_for_upgrade: "0.1.0" # Why? What?
rank: 50

post_deploy_errands: []

pre_delete_errands: []

form_types:
- name: only-plan
  label: The Only Plan
  description: Properties for the Only Plan
  property_inputs:
  - reference: .broker.auto_create_topics
    label: Auto-create topics
    description: Create topics when not present
  - reference: .broker.default_replication_factor
    label: Default replication factor
    description: The Kafka replication factor for a topic when not explicitly specified at topic creation time

job_types:
- name: broker
  resource_label: The Broker
  templates:
  - name: broker
    release: on-demand-service-broker-dev1
  - name: syslog-configurator
    release: on-demand-service-broker-dev1
  - name: kafka-service-adapter
    release: kafka-example-service-adapter-dev1
  static_ip: 0
  dynamic_ip: 1
  max_in_flight: 1
  single_az_only: true
  instance_definition:
    name: instances
    type: integer
    configurable: true
    default: 1
    constraints:
      max: 1
  resource_definitions:
  - name: ram
    type: integer
    configurable: true
    default: 1024
  - name: ephemeral_disk
    type: integer
    configurable: true
    default: 2048
  - name: persistent_disk
    type: integer
    configurable: true
    default: 1024
    constraints:
      min: 1024
  - name: cpu
    type: integer
    configurable: true
    default: 1
  property_blueprints:
  - name: broker_basic_auth
    type: simple_credentials
  - name: auto_create_topics
    type: boolean
    configurable: true
    default: true
  - name: default_replication_factor
    type: integer
    configurable: true
    default: 1
  manifest: |
    broker:
      port: 8080
      username: (( broker_basic_auth.identity ))
      password: (( broker_basic_auth.password ))
      disable_ssl_cert_verification: true
      bosh:
        url: https://10.0.16.10:25555 # Need accessor
        authentication:
          uaa:
            url: https://10.0.16.10:8443 # Need accessor
            client_id: ops_manager # Need accesor for these credentials: Probably impossible to do a cross-deployment link to bosh?
            client_secret: ebb8aa6095cb854676b3
      service_adapter:
        path: /var/vcap/packages/kafka-service-adapter/bin/service-adapter
      service_deployment:
        releases:
          - name: kafka-service-dev1
            version: 0+dev.2
            jobs: [kafka_broker, zookeeper_server]
        stemcell:
          os: ubuntu-trusty
          version: 3215
      service_catalog:
        id: D94A086D-203D-4966-A6F1-60A9E2300F72
        service_name: kafka-dev1
        service_description: Kafka Service
        bindable: true
        plan_updatable: true
        tags: [kafka]
        plans:
          - name: only-plan
            plan_id: 11789210-D743-4C65-9D38-C80B29F4D9C8
            description: An example Kafka plan
            instance_groups:
              - name: kafka_broker
                vm_type: t2.micro
                instances: 3
                persistent_disk: '10240'
                networks: [kafka-service]
                azs: [253f71d09a6367fa3065]
              - name: zookeeper_server
                vm_type: t2.micro
                instances: 1
                persistent_disk: '10240'
                networks: [kafka-service]
                azs: [253f71d09a6367fa3065]
            properties:
              auto_create_topics: (( .broker.auto_create_topics.value ))
              default_replication_factor: (( .broker.default_replication_factor.value ))
